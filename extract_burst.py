import argparse

import numpy as np
#%matplotlib inline
import matplotlib as mpl
import matplotlib.pyplot as plt
import matplotlib.mlab as mlab
from matplotlib.ticker import NullFormatter
import glob
import time
import math

from scipy.optimize import curve_fit

parser = argparse.ArgumentParser(description='')
parser.add_argument('-i', '--input', default='', type=str, metavar='PATH', help='path to npz file')
parser.add_argument('-o', '--output', default='', type=str, metavar='PATH', help='path to image file')



def main():
    args = parser.parse_args()	
    directory = args.input
    out_directory = args.output
    start_time = time.time()

    whole_boundary =  [2.4041392504375003, 7.1832601998125005, 12.918205339062501, 17.697326288437498, 25.58287585490625, 30.36199680428125, 36.09694194353125, 40.87606289290625, 49.00056850684375, 53.779689456218755, 59.7535906429375, 64.53271159231251, 72.89617325371876, 77.67529420309376, 82.93232724740625, 87.71144819678125, 95.83595381071875, 100.58070119573829, 106.03018352609375, 110.76886381335937, 119.06155431607422, 123.80023460333985, 129.4866509480586, 134.22533123532423, 142.2810877236758, 147.01976801094142, 152.23231632693359, 156.97099661419924, 165.26368711691407, 170.239301418543, 175.92571776326173, 180.66439805052735, 188.48322052451562, 193.32574381328126, 198.5739437174805, 203.32231505937503, 211.56948633740237, 216.3178576792969, 222.06588614580082, 226.81425748769533, 234.81151448457035, 239.55988582646486, 244.8080857306641, 249.55645707255863, 257.5537140694336, 262.30208541132816, 268.0501138778321, 272.79848521972656, 280.7957422166016, 285.5441135584961, 291.04222774384766, 295.68189369965626, 304.21751849239064, 309.0950183739531, 314.70414323775003, 319.5816431193125, 327.8733929179688, 332.75089279953124, 338.6038926574063, 343.23751754489064, 351.773142337625, 356.6506422191875, 362.5036420770625, 367.1372669645469, 375.42901676320315, 380.3065166447656, 386.1595165026406, 390.89659715453126, 398.85761145958986, 403.4801358947852, 409.38669489531253, 414.26602624357423, 422.4838474616992, 427.36317880996097, 432.49931707128906, 437.3786484195508, 445.5964696376758, 450.2189940728711, 455.8687461603321, 460.49127059552734, 468.7090918136524, 473.5884231619141, 478.9813683363086, 483.6038927715039, 491.5649070765625, 496.35835746117186, 502.11049731520313, 506.9039471935625, 515.2924844806914, 520.0859343590507, 525.838074213082, 530.6315240914414, 539.0200613785703, 543.8135112569297, 549.086306123125, 553.8797560014843, 562.2682932886132, 567.0617431669726, 572.334538033168, 576.8883154176094, 585.0371802108203, 589.7633202233125, 595.5868531995625, 600.2456795805625, 622.9574581879375, 627.6162845689375, 633.4398175451876, 638.389820575, 646.54276674175, 651.2015931227501, 657.0251260990001, 661.68395248, 670.1280752955626, 674.7869016765626, 680.901611301625, 685.5604376826251, 694.0045604981876, 698.6633868791876, 703.9045665578126, 708.7110314685938, 717.1223436624609, 721.9288077732423, 727.6965647061797, 732.503028816961, 740.6740178052892, 745.4804819160704, 751.2482388490079, 756.0547029597891, 763.9853687425782, 768.7918328533594, 774.559589786297, 779.3660538970782, 787.5370428854063, 792.3435069961876, 798.1112639291251, 802.8851900587814, 811.201599798586, 815.9538339356172, 821.8941266069063, 826.6463607439375, 834.4875470700391, 839.2397812070703, 844.9424621715078, 849.9323080153907, 858.2487177551953, 863.0009518922266, 868.7036328566641, 873.4558669936954, 881.7722767335, 886.5245108705312, 892.4648035418203, 897.2207738320079, 905.5517105832188, 910.312245869625, 916.0248882133126, 920.7854234997188, 928.6403067222891, 933.6388687730157, 938.6374308237423, 943.6359928744688, 951.9669296256798, 956.727464912086, 962.4401072557735, 967.2006425421797, 975.5315792933907, 980.2921145797969, 985.5287033948438, 990.2892390171876, 998.3258475314923, 1002.9922653785079, 1008.6956649693047, 1013.6213282522657, 1021.9171822025157, 1026.5836000495312, 1032.027754204383, 1036.6941720513985, 1044.9900260016486, 1049.9156892846095, 1055.8783343113516, 1060.5447521583674, 1068.3221152367266, 1073.2477785196877, 1078.9511781104845, 1083.6175959575, 1092.1726953436955, 1096.785844795594, 1102.6159069836797, 1107.2799567341485, 1115.2088413099455, 1119.872891060414, 1125.7029532485, 1130.6002054864923, 1138.7622925498126, 1143.4263423002812, 1148.7899995133203, 1153.454049263789, 1161.382933839586, 1166.2801860775783, 1171.4106408030939, 1176.0746905535625, 1184.0035751293594, 1188.7796488006172, 1194.5727281683478, 1199.358315472125, 1207.41825198375, 1212.2038392875274, 1217.4931726232812, 1222.2787599270587, 1229.834950406707, 1234.6205377104843, 1240.6654900942033, 1245.1992043819923, 1253.7628869255939, 1258.548474229371, 1264.3415535971017, 1269.1271409008789, 1277.4389504284923, 1282.2245377322695, 1287.5138710680235, 1292.4452127538752, 1300.7469527386797, 1305.4512720634025, 1310.7090407204455, 1315.413360045168, 1323.4383753638126, 1328.1426946885354, 1333.9539126778986, 1338.6582320026212, 1361.349654627754, 1366.0539739524768, 1371.86519194184, 1376.5695112665626, 1385.1479759175274, 1389.8522952422502, 1395.6635132316135, 1400.5048951264766, 1408.2080832578047, 1413.0867690743125, 1418.9925466416641, 1423.614459520461, 1432.087966464922, 1436.9666522814298, 1442.3588839733595, 1447.2375697898672, 1455.4543037966173, 1460.0762166754141, 1465.4684483673439, 1470.0903612461407, 1478.0503223151798, 1482.9290081316876, 1488.3212398236174, 1492.9431527024142, 1500.9031137714533, 1505.7318593739376, 1511.4854589954375, 1516.2801253466876, 1523.9515915086874, 1528.7462578599375, 1534.0203908463125, 1538.8150571975625, 1547.20572331225, 1552.0003896635, 1557.9937226025627, 1562.7883889538125, 1571.1790550685, 1575.97372141975, 1581.9670543588127, 1586.7617207100627, 1595.1523868247502, 1599.9015663786329, 1605.7915201510937, 1610.5034831690625, 1618.9850166014062, 1623.696979619375, 1628.8801389391406, 1633.5921019571094, 1641.6024390876562, 1646.314402105625, 1651.4975614253906, 1656.4451225942578, 1664.2198615739062, 1668.931824591875, 1674.821778364336, 1679.5337413823047, 1687.5440785128517, 1692.3111620534219, 1698.1525100296562, 1702.9779714013282, 1710.8510925866876, 1715.6765539583594, 1721.2639302834532, 1726.0893916551252, 1734.4704561427657, 1739.2959175144376, 1744.6293221883907, 1749.2008119089219, 1757.8358480477032, 1762.4073377682346, 1768.248685744469, 1773.0741471161407, 1781.4552116037814, 1786.2806729754534, 1792.1220209516878, 1796.8744030403752, 1805.2815174085626, 1809.9521365020003, 1815.0898175047814, 1819.9939675528908, 1827.9340200117344, 1832.604639105172, 1838.4429129719688, 1843.3470630200782, 1851.287115478922, 1855.9577345723594, 1861.7960084391564, 1866.7001584872658, 1875.1072728554532, 1879.7778919488908, 1884.915572951672, 1889.7854925743907, 1897.4113280537579, 1902.264132449719, 1907.5791086929141, 1912.200827165258, 1920.5199204154767, 1925.3727248114376, 1930.4566151310157, 1935.3094195269769, 1942.9352550063438, 1947.788059402305, 1953.7962934163518, 1958.4180118886954, 1966.9681910625313, 1971.5899095348752, 1976.9048857780706, 1981.6006797807033, 1989.448741799375, 1994.2051430228125, 1999.6750044297657, 2004.4314056532032, 2012.9929278553907, 2017.7493290788282, 2022.9813704246094, 2027.737771648047, 2036.0614737890626, 2040.8178750125, 2046.763376541797, 2051.5197777652347, 2059.84347990625, 2064.5998811296877, 2069.8319224754687, 2074.695408195719, 2097.421667245938, 2102.083463974188, 2107.327985293469, 2111.989782021719, 2120.1479262961566, 2124.8097230244066, 2130.054244343688, 2134.716041071938, 2142.5828230508596, 2147.2446197791096, 2152.7805033939067, 2157.4423001221567, 2165.8918066921096, 2170.5536034203597, 2176.6722116261876, 2181.3340083544376, 2189.2007903333597, 2193.742325557031, 2199.67448585, 2204.420214084375, 2212.250665671094, 2217.2336803171875, 2222.4539813750002, 2227.199709609375, 2235.030161196094, 2239.775889430469, 2244.9961904882816, 2249.7419187226565, 2258.2842295445316, 2263.0299577789065, 2268.7248316601567, 2273.4705598945316, 2281.775584304688, 2286.577717451422, 2291.856857715137, 2296.633222715641, 2304.929014558621, 2309.705379559125, 2315.487295086051, 2320.263660086555, 2328.5594519295355, 2333.335816930039, 2339.117732456965, 2343.894097457469, 2351.938501668844, 2356.714866669348, 2362.4967821962737, 2367.2731471967777, 2375.066163776547, 2379.842528777051, 2385.121669040766, 2389.8858225518125, 2398.3426788101874, 2403.0409322870623, 2408.913749133156, 2413.612002610031, 2421.599033520719, 2426.297286997594, 2431.4653658221564, 2436.398531972875, 2444.150650209719, 2449.0838163604376, 2454.251895185, 2458.950148661875, 2466.937179572563, 2471.635433049438, 2476.8035118740004, 2481.6519385778906, 2489.9700679016405, 2494.908957187617, 2500.8876126390624, 2505.566560383672, 2514.144631248789, 2518.8235789933983, 2524.5422929034767, 2529.2212406480858, 2537.0194868891017, 2541.698434633711, 2547.677090085156, 2552.6159793711327, 2560.9341086948825, 2565.613056439492, 2570.811887266836, 2575.7507765528126, 2584.0689058765624, 2588.762180878125, 2593.9247823675, 2598.8527201528127, 2607.300613499063, 2611.9938875803127, 2617.860480181875, 2622.553754263125, 2630.53232020125, 2635.2255942825, 2641.092186884063, 2645.7854609653127, 2653.7640269034378, 2658.4573009846877, 2663.6199024740627, 2668.5478402593753, 2676.7610699015627, 2681.49718458125, 2687.4351780812503, 2692.18557288125, 2700.0237243012502, 2704.77411910125, 2710.47459286125, 2715.22498766125, 2723.06313908125, 2728.05105362125, 2733.27648790125, 2738.02688270125, 2746.34007360125, 2751.0904684012503, 2757.02846190125, 2761.7788567012503, 2769.6170081212504, 2774.4026109207034, 2779.6597828739846, 2784.3328246102346, 2792.8027127571877, 2797.4757544934378, 2803.31705666375, 2808.2821635085156, 2831.0632419727344, 2835.7362837089845, 2841.577585879297, 2846.2506276155473, 2854.7205157625003, 2859.3935574987504, 2865.526924777578, 2870.1999665138283, 2878.6698546607813, 2883.3428963970314, 2889.184198567344, 2893.7981221537775, 2902.0947547603596, 2907.072734324309, 2912.2877605341605, 2917.0286934522073, 2925.3253260587894, 2930.0662589768363, 2935.281285186688, 2940.0222181047347, 2948.555897357219, 2953.2968302752656, 2958.985949776922, 2963.726882694969, 2971.549422009746, 2976.290354927793, 2981.5053811376447, 2986.3762377453986, 2994.5556629386483, 2999.156589609852, 3004.524337392922, 3009.3808711014144, 3017.049082220086, 3021.9056159285783, 3027.528970748938, 3032.3855044574298, 3040.309322613391, 3044.910249284594, 3051.0448181795314, 3055.6457448507344, 3063.5695630066957, 3068.170489677899, 3074.049451535547, 3078.9059852440396, 3086.8298034000004, 3091.560538705078, 3097.237421065547, 3101.9681563659374, 3109.773869611582, 3114.7411416769924, 3119.944950507422, 3124.6756858078124, 3132.481399053457, 3137.212134353848, 3143.1255534793363, 3147.8562887797266, 3155.6620020253713, 3160.6292740907816, 3166.3061564512504, 3171.2734285166603, 3179.079141762305, 3184.054761329172, 3189.2752625000157, 3194.021172655328, 3201.8519244115937, 3206.5978345669064, 3212.2929267532813, 3217.038836908594, 3225.581475188156, 3230.327385343469, 3235.5478865143127, 3240.293796669625, 3248.8364349491876, 3253.5823451045003, 3258.8028462753437, 3263.5487564306563, 3271.6168036946874, 3276.3627138703127, 3281.9472389832035, 3286.51639589375, 3294.893183563086, 3299.7161825242188, 3305.8083917382814, 3310.631390699414, 3319.00817836875, 3323.577335279297, 3329.4157024427736, 3334.2387014039064, 3342.6154890732423, 3347.438488034375, 3353.2768551978515, 3358.0998541589843, 3365.9689577271483, 3370.791956688281, 3376.376481801172, 3381.185585626461, 3389.4007132121446, 3394.329789763555, 3399.4935842459845, 3404.187942866375, 3411.9336345900197, 3416.86271114143, 3422.261223554879, 3426.9555821752697, 3435.1707097609533, 3439.865068381344, 3445.9677345878517, 3450.6620932082424, 3458.407784931887, 3463.336861483297, 3468.5006559657268, 3473.244681503145, 3481.409333068254, 3486.3664429470705, 3491.6151475246406, 3496.2806627047034, 3504.4453142698126, 3509.1108294498754, 3514.651128726199, 3519.316643906262, 3527.7728901701253, 3532.4384053501876, 3537.6871099277582, 3542.3526251078206, 3565.097011610625, 3570.0541214894415, 3575.302826067012, 3579.9683412470745, 3587.84139811343, 3592.729746215078, 3598.4699572560157, 3603.253466456797, 3611.1462566380865, 3615.6905903788283, 3621.669976879805, 3626.453486080586, 3634.8246271819535, 3639.6081363827348, 3644.869996503594, 3649.653505704375, 3657.7854713457036, 3662.568980546485, 3668.070016127383, 3672.8535253281643, 3681.2246664295317, 3686.0005672596876, 3691.9561774706253, 3696.7206656393755, 3705.058519934688, 3709.8230081034376, 3715.0639450890626, 3719.828433257813, 3727.451614327813, 3732.2161024965626, 3738.1717127075003, 3742.93620087625, 3751.274055171563, 3756.0385433403126, 3761.2794803259376, 3766.0439684946878, 3774.38182279, 3779.38453536875, 3784.384129756094, 3789.1337444240703, 3797.3830751631876, 3802.132689831164, 3807.8822233766095, 3812.631838044586, 3821.1311485030706, 3825.880763171047, 3831.130337277758, 3835.8799519457343, 3843.6293232461176, 3848.378937914094, 3854.3784511789063, 3859.128065846883, 3867.6273763053673, 3872.3769909733437, 3877.6265650800547, 3882.43516013918, 3890.9055067515237, 3895.6112548694928, 3900.787577799258, 3905.7286133231255, 3913.4930977177737, 3918.1988458357428, 3923.8457435773053, 3928.551491695274, 3936.3159760899225, 3941.2570116137895, 3946.4333345435552, 3951.139082661524, 3958.9035670561725, 3963.8446025800395, 3969.491500321602, 3974.2658677302034, 3982.2688422667816, 3986.915730707375, 3992.078940085813, 3996.9839889953287, 4004.7288030629848, 4009.3756915035783, 4015.3133822887817, 4020.2184311982974, 4029.254047610563, 4033.900936051157, 4039.8386268363597, 4044.4855152769533, 4052.23032934461, 4057.1353782541255, 4062.8149085704067, 4067.7199574799224, 4075.4647715475785, 4080.2470147380864, 4086.066082746875, 4090.7213371539065, 4098.63526964586, 4103.523286773243, 4109.342354782031, 4113.997609189063, 4122.609829842071, 4127.265084249102, 4132.3858640968365, 4137.27388122422, 4144.955050995821, 4149.843068123204, 4155.429373411641, 4160.317390539024, 4167.998560310625, 4172.7413025272035, 4178.742633898981, 4183.543698996403, 4191.465456407149, 4196.026468249699, 4201.7877463666055, 4206.5888114640275, 4214.990675384516, 4219.791740481937, 4225.793071853715, 4230.5941369511365, 4238.755947616754, 4243.5570127141755, 4249.318290831082, 4254.119355928504, 4262.04111333925, 4266.749158471676, 4272.819506243719, 4277.444533117657, 4300.8587316669655, 4305.483758540902, 4311.265042133325, 4316.1791331868835, 4324.5619943958945, 4329.187021269832, 4334.6792406826335, 4339.593331736191, 4347.398064585961, 4352.023091459899, 4357.80437505232, 4362.718466105879, 4370.523198955649, 4375.148225829586, 4380.640445242387, 4385.26577785075, 4393.016940996437, 4397.714615630188, 4403.821592654062, 4408.519267287813, 4416.975081628563, 4421.672756262313, 4427.544849554501, 4432.477407919938, 4440.228571065625, 4444.926245699376, 4450.798338991563, 4455.496013625313, 4463.247176771, 4468.179735136438, 4473.347177233563, 4478.034974120641, 4486.458460451829, 4491.372160811688, 4496.519846902969, 4501.199561531406, 4508.921090668328, 4513.834791028188, 4518.982477119469, 4523.896177479329, 4532.085678079094, 4536.9993784389535, 4542.8490217245, 4547.76272208436, 4555.484251221282, 4560.163965849719, 4565.545637672422, 4570.348679217091, 4578.625512996466, 4583.539883052969, 4589.23020627629, 4594.144576332794, 4602.421410112169, 4607.3357801686725, 4612.508801280782, 4617.16452028168, 4625.441354061055, 4630.3557241175595, 4636.046047340879, 4640.701766341778, 4649.237251176759, 4653.892970177657, 4659.065991289766, 4663.98036134627, 4671.7398930144345, 4676.515032327047, 4681.925695517501, 4686.630620030938, 4694.39374547811, 4699.333916217219, 4704.979825633344, 4709.919996372453, 4717.683121819625, 4722.388046333062, 4728.269201974859, 4732.974126488297, 4740.7372519354685, 4745.442176448906, 4750.852839639359, 4755.793010378468, 4763.556135825641, 4768.373826139446, 4774.155005048516, 4778.679405933875, 4786.722785285625, 4791.498541775727, 4797.279720684797, 4802.055477174898, 4810.601567736133, 4815.125968621493, 4820.907147530563, 4825.682904020665, 4833.726283372414, 4838.5020398625165, 4843.780507562102, 4848.556264052204, 4856.348287799212, 4861.124044289313, 4867.156578803126, 4871.812731600938, 4879.4953830392815, 4884.151535426156, 4889.506110671063, 4894.395070677281, 4902.077722115625, 4906.7338745025, 4912.088449747406, 4916.744602134281, 4925.125676430656, 4930.014636436876, 4935.136404062438, 4939.7925564493125, 4947.940823126344, 4952.596975513219, 4958.417165996813, 4963.044730365001, 4971.340040600626, 4976.040716400813, 4981.84743356575, 4986.548109365938, 4994.290398919188, 4998.991074719375, 5004.797791884313, 5009.498467684501, 5032.448826003063, 5037.14950180325, 5042.956218968188, 5047.656894768375, 5055.9522050040005, 5060.652880804188, 5066.736108310313, 5071.64809268886, 5079.80092545336, 5084.6416699072815, 5089.737190385094, 5094.577934839016, 5102.9855436274065, 5107.826288081328, 5112.921808559141, 5117.762553013063, 5125.405833729781, 5130.246578183704, 5136.106426733188, 5140.692395163219, 5148.590451903829, 5153.17642033386, 5158.526716835562, 5163.367461289485, 5171.775070077875, 5176.513771664312, 5182.325642011383, 5187.207613102922, 5195.111756774938, 5199.761253052594, 5205.8055982135475, 5210.455094491203, 5218.824187790985, 5223.706158882524, 5228.820604787946, 5233.702575879484, 5242.071669179266, 5246.721165456922, 5252.068086176227, 5256.950057267766, 5264.621726125899, 5269.527880804875, 5274.675579039898, 5279.589290991512, 5287.310838344047, 5292.22455029566, 5297.840221097504, 5302.753933049117, 5310.475480401652, 5315.155206069856, 5320.770876871699, 5325.684588823313, 5333.406136175848, 5338.319848127461, 5343.467546362484, 5348.381258314098, 5356.102805666633, 5360.909392152789, 5366.26711696177, 5370.859452512324, 5379.533864107817, 5384.38132941118, 5389.994183972969, 5394.841649276332, 5402.7506716133985, 5407.598136916762, 5413.4661212313595, 5418.058456781914, 5426.477738624598, 5431.325203927961, 5436.93805848975, 5441.7855237931135, 5450.204805635797, 5455.05227093916, 5460.920255253758, 5465.733056777016, 5474.099110654633, 5478.879712870415, 5484.616435529352, 5489.397037745133, 5497.285031401172, 5502.065633616953, 5507.802356275891, 5512.582958491672, 5520.949012369289, 5525.7296145850705, 5530.98827702243, 5535.768879238211, 5544.134933115828, 5548.91553533161, 5554.413227879758, 5559.167994985555, 5567.433574324344, 5572.156762517938, 5577.58842894057, 5582.311617134164, 5590.1048776535945, 5594.828065847188, 5600.023572860141, 5604.746761053735, 5612.776180982844, 5617.4993691764375, 5623.40335441843, 5628.1265426120235, 5636.392121950813, 5641.115310144407, 5646.783135976719, 5651.506324471875, 5659.394196004617, 5664.360633636344, 5669.619214658172, 5674.2935088997965, 5682.181380432539, 5686.855674674164, 5692.406399086094, 5697.080693327719, 5704.67642147036, 5709.350715711985, 5715.485726904118, 5720.160021145743, 5728.6321794586875, 5733.306473700313, 5739.149341502344, 5743.823635743969, 5766.610820171892, 5771.189536781298, 5776.605760799356, 5781.315520815059, 5789.793088843325, 5794.502848859028, 5799.919072877086, 5804.628832892789, 5812.3999369186995, 5817.1096969344035, 5822.290432951677, 5827.235680968165, 5835.24227299486, 5840.1875210113485, 5845.368257028622, 5850.078017044325, 5858.320097071805, 5863.027697729477, 5868.887888761996, 5873.576041588011, 5881.545901392238, 5886.234054218254, 5892.094245250773, 5896.782398076789, 5905.221073163617, 5910.143633630933, 5915.769417022152, 5920.691977489469, 5928.4274296523945, 5933.349990119711, 5938.97577351093, 5943.663926336945, 5951.399378499871, 5956.321940851562, 5962.09788161036, 5966.869310932843, 5975.4076581415, 5980.179087463985, 5985.4527725046255, 5989.973073968032, 5998.511421176688, 6003.282850499172, 6009.058791257969, 6013.830220580453, 6022.117439930032, 6026.888869252516, 6032.6648100113125, 6037.436239333797, 6045.974586542454, 6050.746015864938, 6056.521956623735, 6061.225219355778, 6069.660843325606, 6074.347301086622, 6079.7367275117895, 6084.423185272805, 6092.8588092426335, 6097.545267003648, 6102.934693428817, 6107.621151189833, 6115.588129383559, 6120.274587144575, 6126.132659345844, 6130.819117106859, 6138.786095300587, 6143.4725530616015, 6148.627656598719, 6153.36738358322, 6161.485289423954, 6166.021766217305, 6171.752052693118, 6176.527291422962, 6185.12272113668, 6189.897959866524, 6195.628246342337, 6200.40348507218, 6208.760152849407, 6213.53539157925, 6218.788154182079, 6223.563392911922, 6231.920060689149, 6236.695299418992, 6241.948062021821, 6246.7808697761175, 6255.293270818094, 6259.9363986591725, 6265.095429593704, 6269.996508981508, 6278.5089100234845, 6283.152037864563, 6288.569020345821, 6293.212148186899, 6301.466597682149, 6306.109725523227, 6312.042611097938, 6316.685738939016, 6325.198139980993, 6329.84126782207, 6335.258250303328, 6340.159329691133, 6348.155827639656, 6352.793927474688, 6358.083157936313, 6362.891549265063, 6371.065814523938, 6375.874205852688, 6381.644275447188, 6386.212247209501, 6394.626932034813, 6399.435323363563, 6405.4458125245, 6410.013784286813, 6418.428469112126, 6423.236860440876, 6429.006930035375, 6433.815321364125, 6442.2300061894375, 6446.806455923262, 6452.610433703809, 6457.543814817273, 6465.959582599066, 6470.602764823504, 6476.406742604051, 6481.340123717516, 6504.556034839703, 6509.199217064141, 6514.422797066633, 6519.356178180098, 6527.191548183836, 6531.834730408274, 6537.638708188821, 6542.572089302285, 6550.987857084078, 6555.631039308516, 6560.854619311009, 6565.494361512001, 6574.090619939251, 6578.866319065501, 6584.119588104376, 6588.895287230625, 6596.536405832626, 6601.312104958875, 6607.0429439103755, 6611.818643036626, 6619.698546594938, 6624.474245721188, 6630.443869629001, 6635.21956875525, 6643.5770422261885, 6648.352741352438, 6654.083580303938, 6658.811152400532, 6667.190835460735, 6671.846214938626, 6677.1999013382, 6681.85528081609, 6689.7694259285045, 6694.4248054063955, 6699.77849180597, 6704.43387128386, 6712.813554344063, 6717.701702795848, 6722.822620221528, 6727.710768673313, 6735.624913785727, 6740.280293263618, 6746.099517610981, 6750.839145719078, 6759.186403022578, 6763.881735255797, 6769.881326442687, 6774.576658675906, 6783.184767770141, 6787.880100003359, 6793.3579876087815, 6798.053319842, 6806.139725354766, 6810.835057587985, 6816.052093402672, 6820.747425635891, 6829.094682939391, 6834.050866963344, 6839.7896063595, 6844.745790383453, 6853.0930476869535, 6857.9781456116025, 6863.946210021563, 6868.720661549532, 6876.59850657068, 6881.372958098649, 6886.8635773558135, 6891.638028883782, 6900.232041634125, 6905.006493162095, 6910.735834995657, 6915.510286523626, 6923.388131544774, 6928.162583072743, 6934.130647482703, 6938.9050990106725, 6946.544221455422, 6951.4067767545, 6956.728313647594, 6961.54303750325, 6969.905452620969, 6974.720176476625, 6980.548526407157, 6985.109843744094, 6993.472258861812, 6998.286982717469, 7004.115332648001, 7008.676649984938, 7017.039065102656, 7021.853788958313, 7027.175325851406, 7031.990049707063, 7040.099058306063, 7044.913782161719, 7050.995538610969, 7055.755402150161, 7063.345223192536, 7068.3260432515945, 7073.544045218227, 7078.287683369712, 7086.351868227235, 7091.332688286294, 7097.0250540680745, 7101.768692219559, 7110.0700589846565, 7114.813697136141, 7120.5060629179225, 7125.486882976981, 7133.788249742079, 7138.531887893563, 7143.749889860196, 7148.564911711438, 7156.437452467563, 7161.323857074813, 7167.024662449938, 7171.639600134563, 7180.0550747359375, 7184.670012420563, 7190.099350873063, 7194.714288557688, 7203.129763159063, 7207.7447008436875, 7213.445506218813, 7218.331910826063, 7241.135132326563, 7245.750070011188, 7250.907941541062, 7255.744807223172, 7264.294506028012, 7268.957978103379, 7274.1396137426755, 7279.062167600008, 7287.352784622883, 7292.01625669825, 7297.197892337547, 7302.120446194879, 7310.411063217754, 7315.333617075086, 7320.515252714383, 7325.17872478975, 7333.469341812625, 7338.132813887993, 7344.091694873184, 7348.755166948551, 7357.304865753391, 7361.891572356407, 7367.098795192469, 7371.8326341343445, 7380.353544229719, 7385.087383171594, 7390.2946060076565, 7395.028444949532, 7403.312663097813, 7408.046502039688, 7413.9638007170315, 7418.697639658907, 7426.981857807188, 7431.715696749063, 7436.922919585126, 7441.656758527, 7449.704284728188, 7454.56304370547, 7460.279804061172, 7465.069522197032, 7472.949381065704, 7477.7390992015635, 7483.610366593907, 7488.554591766407, 7496.74346470836, 7501.6876898808605, 7507.249943199923, 7512.194168372423]




    num_images = int(len(whole_boundary)/2)

    print('length of whole_boundary: ', len(whole_boundary))    
    print('The number of images: ', num_images)    
    
    bin = 0
    print(f'Boundary time: [{whole_boundary[2*bin]}, {whole_boundary[2*bin+1]}]')

    x_burst=np.ndarray([num_images], dtype=list)
    y_burst=np.ndarray([num_images], dtype=list)
    toa_burst=np.ndarray([num_images], dtype=list)
    tot_burst=np.ndarray([num_images], dtype=list)
    
    
    for i in range(num_images):
        x_burst[i] = []
        y_burst[i] = []
        toa_burst[i] = []
        tot_burst[i] = []
        
        

    
    beam_on = False

    img_data = np.zeros([256,256])

    for i in range(76):

        #filename = directory + f'/toa-{i}.npz'	
        f_x = open(directory + f'/x-{i}.npz', "rb")
        f_y = open(directory + f'/y-{i}.npz', "rb")
        f_toa = open(directory + f'/toa-{i}.npz', "rb")
        f_tot = open(directory + f'/tot-{i}.npz', "rb")
        #print(filename)


        x = np.load(f_x)
        y = np.load(f_y)
        toa = np.load(f_toa)
        tot = np.load(f_tot)

        f_x.close()
        f_y.close()
        f_toa.close()
        f_tot.close()

        data_length = len(toa)

        #print('data_length: ', data_length)
        #boundary = []
        



        for k in range(data_length):

            if toa[k] > whole_boundary[2*bin+1]:
                for l in range(len(y_burst[bin])):
                    #j = x_burst[l]
                    #i = 255 - y_burst[l]
                    xi = x_burst[bin][l]
                    yi = y_burst[bin][l]
                    img_data[xi][yi] = img_data[xi][yi] + tot_burst[bin][l]               

                f_image = open(out_directory + f'/image-{bin}.npz', "wb")
                np.save(f_image, img_data)
                f_image.close()
                print(f'[{i}]: Save Image: image-{bin}.npz')
                img_data = np.zeros([256,256])

                bin = bin + 1
                print(f'Boundary time: [{whole_boundary[2*bin]}, {whole_boundary[2*bin+1]}]')

            if toa[k] > whole_boundary[2*bin] and toa[k] < whole_boundary[2*bin+1]:
                x_burst[bin].append(x[k])
                y_burst[bin].append(y[k])
                toa_burst[bin].append(toa[k])
                tot_burst[bin].append(tot[k])





        end_time = time.time()
        print(f'[{i}]: Running time: {end_time - start_time}.')
        start_time = end_time


    #print('whole_boundary = ', whole_boundary)




if __name__ == "__main__":
    main()



